<mat-card *ngIf="!done else doneTemplate" class="extend-term" credixCard fxLayout="column">

  <h1 class="mb-4px">{{titleTag || 'Ampliar plazo de compra'}}</h1>

  <p>Haga su cuota más pequeña, ampliando el plazo de su compra.</p>

  <credix-navigation-table [headers]="tableHeaders" [hide]="empty" class="mt-24px">

    <ngx-simplebar [options]="{autoHide: false, scrollbarMinSize: 100}" class="extend-term__menu-options" left>
      <div class="pl-16px pr-16px" fxLayout="column">
        <a (click)="getAllowedMovementDetail(allowedMovement)"
           *ngFor="let allowedMovement of allowedMovements, let last = last"
           class="extend-term__option" fxLayout="column">
          <div fxLayout="row" fxLayoutAlign="space-between center">
            <p [class.is-selected]="allowedMovementSelected?.movementId == allowedMovement.movementId"
               class="extend-term__option__label truncate"
               fxFlex="150px">{{allowedMovement.establishmentName}}</p>
            <p class="tr extend-term__content__date">
              {{allowedMovement.originDate | dateFormatter: "alphanumeric"}}
            </p>
          </div>
          <span [class.is-selected]="allowedMovementSelected?.movementId == allowedMovement.movementId"
                class="extend-term__content__subtitle">
              <credix-numeric-block [prefix]="allowedMovement.originCurrency.currency"
                                    [value]="allowedMovement.originAmount" fontSize="16"
                                    fontWeight="allowedMovementSelected?.id == option.id ? 'bold': 'normal'"></credix-numeric-block>
              a {{ allowedMovement.totalPlanQuota }} Cuotas
            </span>
          <span *ngIf="allowedMovementSelected?.movementId == allowedMovement.movementId"
                class="extend-term__option__arrow"></span>
        </a>
      </div>
    </ngx-simplebar>

    <div *ngIf="allowedMovementSelected" class="extend-term__content-right" fxFlexAlign="center"
         fxLayout="column" right>

      <div fxLayout="row" fxLayoutAlign="space-between center">
        <p class="truncate" fxFlex="221px"><strong>{{allowedMovementSelected?.establishmentName}}</strong></p>
        <p class="tr extend-term__content__date-smaller">{{ allowedMovementSelected?.originDate }}</p>
      </div>

      <p class="extend-term__content__subtitle">
        <credix-numeric-block [prefix]="allowedMovementSelected?.originCurrency.currency"
                              [value]="allowedMovementSelected?.originAmount"
                              fontSize="14" fontWeight="bold"></credix-numeric-block>
        a {{ allowedMovementSelected?.totalPlanQuota }} Cuotas
      </p>

      <div class="extend-term__content-right__option" fxLayout="row" fxLayoutAlign="space-between">
        <p fxFlex>{{quotaTag || 'Cuota actual'}}</p>
        <credix-numeric-block [prefix]="allowedMovementSelected?.originCurrency.currency"
                              [value]="quotaAmountFromSelected"
                              fontSize="16" fontWeight="bold"></credix-numeric-block>
      </div>

      <div class="mt-16px" fxLayout="column" fxLayoutGap="16px">

        <p class="mb-8px"><strong>{{subtitle || 'Modifique su plazo'}}</strong></p>

        <credix-slider (inputChange)="getQuota($event)"
                       (valueChange)="getQuota($event)"
                       [displayMax]="quotaSliderDisplayMax"
                       [displayMin]="quotaSliderDisplayMin"
                       [displayValue]="quotaSliderDisplayValue"
                       [max]="quotaSliderMax"
                       [min]="quotaSliderMin"
                       [step]="quotaSliderStep"
                       class="second-step__slider"
                       instructions="{{deseoTag || 'Deseo ampliar este plazo a'}}" units="cuotas"></credix-slider>

        <div fxLayout="row" fxLayoutAlign="space-between">
          <p fxFlex="95px">{{resultNew || 'Plazo nuevo'}}</p>
          <span [ngClass]="{'extend-term__text-disabled' :
          allowedMovementSelected?.totalPlanQuota === quotaSelected?.quotaTo}">
            <strong>{{ quotaSelected?.quotaTo }} {{monthTag || 'meses'}}</strong></span>
        </div>

        <div fxLayout="row" fxLayoutAlign="space-between">
          <p fxFlex="95px">{{newQuota || 'Cuota nueva'}}</p>
          <div [ngClass]="{'extend-term__text-disabled' :
           allowedMovementSelected?.totalPlanQuota === quotaSelected?.quotaTo}">
            <credix-numeric-block [prefix]="allowedMovementSelected?.originCurrency.currency"
                                  [value]="quotaSelected?.amountPerQuota"
                                  fontSize="16" fontWeight="bold"></credix-numeric-block>
          </div>
        </div>

        <div fxLayout="row" fxLayoutAlign="space-between">
          <p fxFlex="95px">{{comisionTag || 'Comisión'}}*</p>
          <div [ngClass]="{'extend-term__text-disabled' :
          allowedMovementSelected?.totalPlanQuota === quotaSelected?.quotaTo}">
            <credix-numeric-block [prefix]="allowedMovementSelected?.originCurrency.currency"
                                  [value]="quotaSelected?.feeAmount"
                                  fontSize="16" fontWeight="bold"></credix-numeric-block>
          </div>
        </div>

        <div fxLayout="row" fxLayoutAlign="space-between">
          <p fxFlex="95px">IVA*</p>
          <div [ngClass]="{'extend-term__text-disabled' :
           allowedMovementSelected?.totalPlanQuota === quotaSelected?.quotaTo}">
            <credix-numeric-block [prefix]="allowedMovementSelected?.originCurrency.currency"
                                  [value]="quotaSelected?.IVA"
                                  fontSize="16" fontWeight="bold"></credix-numeric-block>
          </div>
        </div>

        <p class="extend-term__message">
          {{disclaTag || '* IVA y comisión se cargarán en el próximo estado de cuenta'}}.</p>
      </div>
    </div>

  </credix-navigation-table>

  <credix-result-notification *ngIf="empty" class="extend-term__empty" status="info"
                              title="{{warningTag || 'No tiene consumos para ampliar en este momento.'}}">
  </credix-result-notification>

  <div class="extend-term__footer" fxLayout="row" fxLayoutAlign="flex-end" fxLayoutGap="16px">
    <credix-button (buttonClick)="openConfirmationModal()" *ngIf="allowedMovementSelected"
                   [disabled]="allowedMovementSelected?.totalPlanQuota === quotaSelected?.quotaTo"
                   text="Ampliar Plazo">
    </credix-button>
  </div>
</mat-card>

<ng-template #doneTemplate>
  <app-credix-result-view [resultMessage]="message"
                          [resultTile]="status === 'success' ? '¡Éxito!' : 'Oops...'"
                          [status]="status"
                          [title]="titleTag || 'Ampliar plazo de compra'"
                          buttonText="Listo"
                          routeTo="/home">

    <div *ngIf="status === 'success'" class="w-100" fxLayout="column">
      <mat-divider class="mb-24px" credixDivider></mat-divider>

      <div fxLayout="row" fxLayoutAlign="space-between">
        <p fxFlex="175px"><strong>Datos de la ampliación</strong></p>

        <div fxLayout="column" fxLayoutGap="8px">
          <div fxLayout="row" fxLayoutAlign="space-between">
            <span fxFlex="95px">{{comercioResult || 'Comercio'}}</span>
            <span class="tr"><strong>{{allowedMovementSelected?.establishmentName}}</strong></span>
          </div>

          <div fxLayout="row" fxLayoutAlign="space-between">
            <span fxFlex>{{newQuota || 'Cuota nueva'}}</span>
            <div>
              <credix-numeric-block [prefix]="currencyCode" [value]="quotaSelected?.feeAmount" fontSize="16"
                                    fontWeight="bold">
              </credix-numeric-block>
            </div>
          </div>

          <div fxLayout="row" fxLayoutAlign="space-between">
            <span fxFlex="95px">Plazo nuevo</span>
            <span class="tr"><strong>{{ quotaSelected?.quotaTo }} Cuota</strong></span>
          </div>

          <div fxLayout="row" fxLayoutAlign="space-between">
            <span fxFlex="95px">{{dateTag || 'Fecha'}}</span>
            <span class="tr"><strong>{{today | dateFormatter: 'numeric'}}</strong></span>
          </div>

        </div>
      </div>

      <credix-share-button fxFlexAlign="center" style="margin-top: 90px"></credix-share-button>
    </div>

  </app-credix-result-view>
</ng-template>
