<mat-card
  class="marchamos"
  [class.height-step-1]="stepperIndex === 0" 
  [class.height-step-2]="stepperIndex === 1"
  [class.height-step-3]="stepperIndex === 2"
  [class.height-step-4]="stepperIndex === 3"  
  fxLayout="column">
  <h1 class="marchamos__title">Marchamo</h1>

    <credix-stepper #stepper *ngIf="!responseResultPay" class="marchamos__stepper">
      <cdk-step [label]="'Consultar'"
                [stepControl]="consultForm"
                fxLayout="column"
                fxLayoutAlign="space-around">

        <div class="marchamos__container">
         
          <marchamo-first-step [consultForm]="consultForm">
          </marchamo-first-step>
          <mat-divider *ngIf="vehicleInformation"></mat-divider>
          <consult-information *ngIf="vehicleInformation" [consultVehicle]="consultVehicle">
          </consult-information>
        </div>

        <mat-divider></mat-divider>
        <div class="marchamos__buttons"
             fxLayoutAlign="flex-end" fxLayoutGap="16px" xLayout="row">

          <credix-button
            (buttonClick)="consult()"
            [disabled]="!consultForm.valid"
            text="Consulta"
            type="secondary">
          </credix-button>

          <credix-button
            (buttonClick)="firstStepContinue()"
            [disabled]="responseToContinue !== 'success'"
            text="Continuar"></credix-button>
        </div>
      </cdk-step>

      <cdk-step [label]="'Seguros y. cuotas'" [stepControl]="secureAndQuotesForm" fxLayout="column">

        <second-step-marchamo 
          [totalMount]="totalMount"
          [billingHistorys]="billingHistorys"
        ></second-step-marchamo>
        

        <mat-divider></mat-divider>
        <form [formGroup]="secureAndQuotesForm">

          <second-step-optional-insurances
          [aditionalProducts]="secureAndQuotesControls.aditionalProducts"
          [amountItemsProducts]="amountItemsProducts">
        </second-step-optional-insurances>

          <mat-divider></mat-divider>
          <second-step-quotes 
          [totalMount]="totalMount"
          [quotesAmount]="quotesAmount"
          [amountItemsProducts]="amountItemsProducts"
          [firstCouteToPayIn]="secureAndQuotesControls.firstCouteToPayIn"
          [quotesToPay]="secureAndQuotesControls.quotesToPay"
          (dataQuotes)="getDataOfQuotes($event)"
          ></second-step-quotes>

        </form>
        <mat-divider></mat-divider>
        <div class="marchamos__buttons" fxLayout="row" fxLayoutAlign="flex-end" fxLayoutGap="16px">
          <credix-button [stepper]="stepper" credixStepperPrevious text="Atras" type="secondary"></credix-button>
          <credix-button (click)="getValuesSecondStep()"
                         [disabled]="secureAndQuotesForm.get('aditionalProducts').value === []"
                         text="Continuar"></credix-button>
        </div>
      </cdk-step>


      <cdk-step [label]="'Lugar de retiro'" [stepControl]="pickUpForm">
        <form [formGroup]="pickUpForm" class="marchamos__form--step-1" fxLayout="column">
         
          <thirsty-step-email-registered
          *ngIf="email !== undefined"
          [email]="email"
          [emailRegistered]="pickUpControls.email"
          ></thirsty-step-email-registered>
         <mat-divider class="marchamos__places-divider"></mat-divider>

          <thirsty-step-place-of-retreat 
          [pickUp]="pickUpControls.pickUp"
          [informationApplicant]="informationApplicant"
          [addressAplicant]="addressAplicant"
          (dataDelivery)="getDataOfDelivery($event)"
          ></thirsty-step-place-of-retreat>
          
        </form>
        <mat-divider class="marchamos__divider-footer"></mat-divider>
        <div class="marchamos__buttons" fxLayout="row" fxLayoutAlign="flex-end" fxLayoutGap="16px">
          <credix-button [stepper]="stepper" credixStepperPrevious text="Atras" type="secondary"></credix-button>
          <credix-button (click)="getValuesThirstyStep()"
                         text="Continuar"></credix-button>
        </div>
      </cdk-step>

      <cdk-step [label]="'Confirmar'">

        <four-step-confirm-contact  [contactToConfirm]="contactToConfirm"></four-step-confirm-contact>
        
        <mat-divider></mat-divider>

        <div class="marchamos__billing-pickup" fxLayout="row">
          <label>Lugar de retiro</label>
          <p>{{placeOfRetreat.placeDescription}}</p>
        </div>

        <mat-divider></mat-divider>


        <four-step-confirm-pay-resume
        [dataPayResume]="dataPayResume"></four-step-confirm-pay-resume>
        

        <mat-divider></mat-divider>

        <div fxLayout="row" fxLayoutGap="104px">
          <div class="marchamos__credix-code" fxLayout="column">
            <label style="font-weight: bold; font-size: 16px;">Código MiCredix</label>
            <p style="font-weight: normal; font-size: 14px;">Ingrese el código generado en la aplicación
              <credix-link-button text="Código MiCredix >"></credix-link-button>
            </p>
          </div>

          <form [formGroup]="confirmForm">
            <credix-code-input
              [(codeFormControl)]="confirmControls.credixCode"
              [length]="6"
              class="w-50"
              errorMessage="Introduzca el codigo de confirmación">
            </credix-code-input>
          </form>
        </div>
        <mat-divider></mat-divider>
        <div class="marchamos__buttons" fxLayout="row" fxLayoutAlign="flex-end" fxLayoutGap="16px">
          <credix-button [stepper]="stepper" credixStepperPrevious text="Atras" type="secondary"></credix-button>
          <credix-button
          [disabled]="!confirmControls.credixCode.value" 
          (buttonClick)="confirmModal()"
          text="Pagar"></credix-button>
        </div>
      </cdk-step>

    </credix-stepper>

    <result-pay-resume 
      *ngIf="responseResultPay"
      [resultPay]="resultPay"
      [dataPay]="dataPay"
      [(responseResultPay)]="responseResultPay"
    ></result-pay-resume>
  
</mat-card>



