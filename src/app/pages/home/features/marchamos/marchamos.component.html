<mat-card
  class="marchamos"
  fxLayout="column"
  [class.full-height]="">
  <h1 class="marchamos__title">Marchamo</h1>
  <ngx-simplebar [options]="options" class="w-100" fxFlex="calc(100% - 106px)">

    <credix-stepper #stepper class="marchamos__stepper">
      <cdk-step [label]="'Consultar'"
                [stepControl]="consultForm"
                fxLayout="column"
                fxLayoutAlign="space-around">

        <div class="marchamos__container">
          <form [formGroup]="consultForm"
                class="marchamos__form--step-1"
                fxLayout="row"
                fxLayoutGap="150px">
            <h3 class="marchamos__sub-title">Vehículo a consultar</h3>

            <div class="marchamos__inputs" fxLayout="column">
              <mat-form-field appearance="standard">
                <mat-label>Tipo de vehículo</mat-label>
                <mat-select formControlName="vehicleType">
                  <mat-option *ngFor="let vehicleTypes of vehicleType" [value]="vehicleTypes.type">
                    {{ vehicleTypes.description}}
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="fill" credixTextField onFocusLabel="Placa">
                <mat-label>
                  Número de placa
                </mat-label>
                  <input formControlName="plateNumber" mask="AAAAAAAA" matInput type="text">
              </mat-form-field>

            </div>

          </form>
          <mat-divider *ngIf="vehicleInformation"></mat-divider>
          <div *ngIf="vehicleInformation" class="marchamos__information" fxLayout="row" fxLayoutGap="119px">
            <h3 class="marchamos__sub-title"
                fxFlex="50">Información del vehículo</h3>
            <div fxLayout="column" fxLayoutGap="64px">
              <div fxLayout="column" class="marchamos__list">
                <div fxLayout="row" fxLayoutGap="183px"><label>Propietario</label> <span>{{consultVehicle.ownerName}}</span></div>
                <div fxLayout="row" fxLayoutGap="277px"><label>Marca</label> <span>{{consultVehicle.brandDescription}}</span></div>
                <div fxLayout="row" fxLayoutGap="315px"><label>Año</label> <span>{{consultVehicle.yearModel}}</span></div>
                <div fxLayout="row" fxLayoutGap="224px"><label>Períodos adeudados</label> <span>{{consultVehicle.owedYears}}</span></div>
                <div fxLayout="row" fxLayoutGap="207px"><label>Período (s) a pagar</label> <span>{{consultVehicle.period}}</span></div>
              </div>
            </div>
          </div>

        </div>

        <mat-divider></mat-divider>
        <div class="marchamos__buttons"
            fxLayoutAlign="flex-end" fxLayoutGap="16px" xLayout="row">

          <credix-button
            (buttonClick)="consult()"
            [disabled]="!consultForm.valid"
            text="Consulta"
            type="secondary">
          </credix-button>

          <credix-button
            (buttonClick)="firstStepContinue()"
            [disabled]="responseToContinue != 'success'"
            text="Continuar"></credix-button>
        </div>
      </cdk-step>

      <cdk-step [label]="'Seguros y. cuotas'" [stepControl]="secureAndQuotesForm" fxLayout="column">

        <div class="marchamos__payment-information" fxLayout="row">
          <label class="marchamos__label-1">Marchamo</label>
          <span class="marchamos__payment-span">Monto al cobro</span>
          <div class="marchamos__prices" fxLayout="column">
            <credix-numeric-block [value]="totalMount" fontSize="20" fontWeight="bold" prefix="₡"></credix-numeric-block>
            <credix-link-button (click)="showDetail()" text="Ver detalles"></credix-link-button>
          </div>
        </div>


        <mat-divider></mat-divider>
        <form [formGroup]="secureAndQuotesForm">
          <div class="marchamos__payment-information secure" fxLayout="row">
            <label class="marchamos__label-2">Seguros opcionales</label>
            <div fxLayout="column" style="margin-right: 215px;">
              <credix-checkbox-button 
              *ngFor="let item of itemProduct" 
              (emitCheckBox)="getValueCheckBoxes($event)" 
              [checked]="isChecked" 
              [value]="item.productCode"
              [label]="item.responseDescription"></credix-checkbox-button>
              <credix-checkbox-button  [value]="10" (emitCheckBox)="getValueOfCheckBoxAll($event)" label="Todos"></credix-checkbox-button>

            </div>
            <div class="marchamos__prices" fxLayout="column">
              <credix-numeric-block [value]="amountItemsProducts.responsabilityCivilAmount" fontSize="16" fontWeight="bold" prefix="₡"></credix-numeric-block>
              <credix-numeric-block [value]="amountItemsProducts.roadAsistanceAmount" fontSize="16" fontWeight="bold" prefix="₡"></credix-numeric-block>
              <credix-numeric-block [value]="amountItemsProducts.moreProtectionAmount" fontSize="16" fontWeight="bold" prefix="₡"></credix-numeric-block>
            </div>
          </div>
          <mat-divider></mat-divider>
          <div class="marchamos__payment-information secure" fxLayout="row">
            <label class="marchamos__label-3">Cuotas</label>

            <div fxLayout="column">
              <div class="marchamos__slider">
                <credix-slider (valueChange)="getValueSlider($event)" 
                              [(value)]="value"
                              [max]="maxQuotes"
                              [instructions]="'Deseo dividir este pago en'" [units]="'Cuota'"></credix-slider>
              </div>

              <label *ngIf="quotesToPayOfAmount" class="marchamos__label-4">Comisión</label>

              <mat-form-field *ngIf="quotesToPayOfAmount" appearance="standard" class="marchamos__select">
                <mat-label>Deseo pagar la primera cuota en</mat-label>
                <mat-select formControlName="firstCouteToPayIn">
                  <mat-option *ngFor="let firstCoute of wishPayFirstCouteIn" [value]="firstCoute.value">
                    {{ firstCoute.description}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="marchamos__prices" fxLayout="column">
              <credix-numeric-block [value]="quotesAmount" fontSize="24" fontWeight="bold" prefix="₡" style="font-size: 24px !important; margin-bottom: 4px;"></credix-numeric-block>
                <!-- <span style="font-size: 24px !important; margin-bottom: 4px;">₡ 114.996,00</span> -->
                <credix-link-button (click)="payResume()" style="margin-bottom: 64px;"
                                    text="Ver detalles"></credix-link-button>
              <credix-numeric-block *ngIf="quotesToPayOfAmount" [value]="commission" fontSize="16" fontWeight="bold" prefix="₡"></credix-numeric-block>
            </div>
          </div>


        </form>
        <mat-divider></mat-divider>
        <div class="marchamos__buttons" fxLayout="row" fxLayoutAlign="flex-end" fxLayoutGap="16px">
          <credix-button [stepper]="stepper" credixStepperPrevious text="Atras" type="secondary"></credix-button>
          <credix-button (click)="getValuesSecondStep()"
                        text="Continuar"></credix-button>
        </div>
      </cdk-step>


      <cdk-step [label]="'Lugar de retiro'" [stepControl]="pickUpForm">
        <form [formGroup]="pickUpForm" class="marchamos__form--step-1" fxLayout="column" fxLayoutGap="150px">
          <div class="marchamos__top-row" fxLayout="row" fxLayoutGap="163px">
            <h3 class="marchamos__sub-title__first">Correo electrónico</h3>

            <div class="marchamos__inputs__first" fxLayout="column">
              <mat-form-field appearance="standard" credixTextField>
                <mat-label>
                  Correo registrado
                </mat-label>
                <label>
                  <input formControlName="email" matInput type="email" [pattern]="'^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$'">
                </label>
              </mat-form-field>

            </div>
          </div>
          <mat-divider class="marchamos__places-divider"></mat-divider>
          <div class="marchamos__bottom-row" fxLayout="row" fxLayoutGap="191px">
            <h3 class="marchamos__sub-title">Lugar de retiro</h3>

            <div class="marchamos__radio-button" fxLayout="column">
              <credix-radio-button [checked]="false" [value]="2" label="Sucursales Credix" name="a" (emitRadioButton)="getRadioButtonsChecked($event)"></credix-radio-button>
              <div *ngIf="radioButtonsChangedValue === 2" class="marchamos__inputs-hidden">
                <mat-form-field appearance="standard">
                  <mat-label>Seleccione la más cercana</mat-label>
                  <mat-select formControlName="pickUp">
                    <mat-option *ngFor="let delivery of deliveryPlaces" [value]="delivery.id">
                      {{delivery.description}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
              <credix-radio-button [checked]="false" [value]="1" label="Domicilio" name="a" (emitRadioButton)="getRadioButtonsChecked($event)"></credix-radio-button>
                <div *ngIf="radioButtonsChangedValue === 1" class="marchamos__inputs-hidden" fxLayout="column">
                  <credix-radio-button [checked]="domicile" [value]="'directionRegister'" label="Dirección registrada en Credix" name="b" (emitRadioButton)="newDirectionChecked($event)"></credix-radio-button>
                    <div *ngIf="!newDeliveryDirection || newDeliveryOption === 'directionRegister'" class="marchamos__delivery-pickup" fxLayout="column">
                      <span> {{domicileDescription.name}} </span>
                      <span> {{domicileDescription.number | mask: '0000-0000'}}</span>
                      <span>{{domicileDescription.detail}}</span>
                       
                      <mat-divider></mat-divider>
                    </div>
                    <div fxLayout="row" fxLayoutGap="16px">
                      <credix-radio-button [checked]="newDomicile" [value]="'newDirection'" label="User otra dirección" name="b" (emitRadioButton)="newDirectionChecked($event)"></credix-radio-button>
                      <credix-link-button *ngIf="newDeliveryDirection !== undefined && newDeliveryDirection !== '' && newDeliveryOption !== 'directionRegister'" class="marchamos__edit-delivery" text="Editar" (click)="editNewDirection(true)"></credix-link-button>
                    </div>
                      <div *ngIf="newDeliveryDirection && newDeliveryOption !== 'directionRegister'" class="marchamos__delivery-pickup" fxLayout="column">
                        <span style="font-weight: bold; font-size: 16px">{{newDeliveryDirection.personReceive}}</span>
                        <span style="font-weight: bold; font-size: 16px">{{newDeliveryDirection.phoneNumber | mask: '0000-0000'}}</span>
                        <p>{{newDeliveryDirection.exactlyDirection}}</p>
                        <mat-divider *ngIf="newDeliveryDirection && newDeliveryOption !== 'directionRegister'"></mat-divider>
                      </div>

                  </div>
                
            </div>
          </div>
          <!-- <mat-divider class="marchamos__divider-footer"></mat-divider>
          <div fxLayout="row" fxLayoutAlign="flex-end" fxLayoutGap="16px" class="marchamos__buttons-footer">
            <credix-button [stepper]="stepper" credixStepperPrevious text="Atras" type="secondary"></credix-button>
            <credix-button (click)="continue()"  text="Continuar">
            </credix-button>
          </div> -->
        </form>
        <mat-divider class="marchamos__divider-footer"></mat-divider>
        <div class="marchamos__buttons" fxLayout="row" fxLayoutAlign="flex-end" fxLayoutGap="16px">
          <credix-button [stepper]="stepper" credixStepperPrevious text="Atras" type="secondary"></credix-button>
          <credix-button (click)="getValuesThirstyStep()"
                        text="Continuar"></credix-button>
        </div>
      </cdk-step>

      <cdk-step [label]="'Confirmar'">

        <div class="marchamos__billing" fxLayout="row">
          <label>Contacto</label>

          <div class="marchamos__billing-contact" fxLayout="column">
            <span>{{contactToConfirm.name}}</span>
            <span>{{contactToConfirm.email}}</span>
            <span>{{contactToConfirm.phone | mask: '0000-0000'}}</span>
          </div>
        </div>

        <mat-divider></mat-divider>

        <div class="marchamos__billing-pickup" fxLayout="row">
          <label>Lugar de retiro</label>
          <p>{{placeOfRetreat.placeDescription}}</p>
        </div>

        <mat-divider></mat-divider>


        <div class="marchamos__billing-information" fxLayout="row" fxLayoutGap="153px">
          <label>Resumen de pago</label>
          <ul class="marchamos__billing-list">
            <li fxLayoutGap="206px"><label>Marchamo</label><credix-numeric-block [value]="totalMount" fontSize="16" fontWeight="bold" prefix="₡"></credix-numeric-block>
            </li>
            <li fxLayoutGap="231px"><label>Seguros</label><credix-numeric-block [value]="totalAmountItemsProducts" fontSize="16" fontWeight="bold" prefix="₡"></credix-numeric-block>
            </li>
            <li fxLayoutGap="225px"><label>Comisión</label><credix-numeric-block [value]="commission" fontSize="16" fontWeight="bold" prefix="₡"></credix-numeric-block>
            </li>
            <li fxLayoutGap="278px"><label>IVA</label><credix-numeric-block [value]="iva" fontSize="16" fontWeight="bold" prefix="₡"></credix-numeric-block>
            </li>
            <mat-divider style="margin-bottom: 16.5px;"></mat-divider>
            <li fxLayoutGap="247px"><label class="marchamos__total">Total</label><credix-numeric-block [value]="totalMount" fontSize="16" fontWeight="bold" prefix="₡"></credix-numeric-block></li>
          </ul>
        </div>


        <mat-divider></mat-divider>

        <div fxLayout="row" fxLayoutGap="104px">
          <div class="marchamos__credix-code" fxLayout="column">
            <label style="font-weight: bold; font-size: 16px;">Código MiCredix</label>
            <p style="font-weight: normal; font-size: 14px;">Ingrese el código generado en la aplicación
              <credix-link-button text="Código MiCredix"></credix-link-button>
            </p>
          </div>

          <form [formGroup]="confirmForm">
            <credix-code-input
              [(codeFormControl)]="confirmControls.credixCode"
              [length]="6"
              class="w-50"
              errorMessage="Introduzca el codigo de confirmación">
            </credix-code-input>
          </form>
        </div>
        <mat-divider></mat-divider>
        <div class="marchamos__buttons" fxLayout="row" fxLayoutAlign="flex-end" fxLayoutGap="16px">
          <credix-button [stepper]="stepper" credixStepperPrevious text="Atras" type="secondary"></credix-button>
          <credix-button (buttonClick)="confirmModal()"
                        text="Pagar"></credix-button>
        </div>
      </cdk-step>

    </credix-stepper>
  </ngx-simplebar>
</mat-card>


