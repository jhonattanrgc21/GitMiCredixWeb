<mat-card *ngIf="!responseResultPay else resultTemplate" [class.marchamos--second-step-height]="stepperIndex === 1"
          class="marchamos"
          credixCard
          fxLayout="column">

  <h1 class="marchamos__title">Marchamo</h1>

  <credix-stepper #stepper class="marchamos__stepper">

    <cdk-step [stepControl]="consultForm" fxLayout="column" label="Consultar">
      <app-marchamo-first-step [consultForm]="consultForm">
      </app-marchamo-first-step>
    </cdk-step>

    <cdk-step [label]="'Seguros y cuotas'" [stepControl]="secureAndQuotesForm" fxLayout="column">
      <app-second-step-marchamo [secureAndQuotesForm]="secureAndQuotesForm"></app-second-step-marchamo>
    </cdk-step>

    <cdk-step [label]="'Lugar de retiro'" [stepControl]="pickUpForm">
      <thirsty-step-email-registered
        *ngIf="email !== undefined"
        [emailRegistered]="pickUpControls.email"
        [email]="email"></thirsty-step-email-registered>
      <mat-divider class="marchamos__places-divider"></mat-divider>

      <thirsty-step-place-of-retreat
        (dataDelivery)="getDataOfDelivery($event)"
        [addressAplicant]="addressAplicant"
        [informationApplicant]="informationApplicant"
        [pickUp]="pickUpControls.pickUp"></thirsty-step-place-of-retreat>
    </cdk-step>

    <cdk-step [label]="'Confirmar'">

      <four-step-confirm-contact [contactToConfirm]="contactToConfirm"></four-step-confirm-contact>

      <mat-divider></mat-divider>

      <div class="marchamos__billing-pickup" fxLayout="row">
        <label>Lugar de retiro</label>
        <p>{{placeOfRetreat.placeDescription}}</p>
      </div>

      <mat-divider></mat-divider>


      <four-step-confirm-pay-resume
        [dataPayResume]="dataPayResume"></four-step-confirm-pay-resume>


      <mat-divider></mat-divider>

      <div fxLayout="row" fxLayoutGap="104px">
        <div class="marchamos__credix-code" fxLayout="column">
          <label style="font-weight: bold; font-size: 16px;">Código MiCredix</label>
          <p style="font-weight: normal; font-size: 14px;">Ingrese el código generado en la aplicación
            <credix-link-button text="Código MiCredix"></credix-link-button>
            <mat-icon style="width: 6px; height: 10px; fill:#239DF7" svgIcon="chevron_right"></mat-icon>
          </p>
        </div>

        <form [formGroup]="confirmForm">
          <credix-code-input
            [(codeFormControl)]="confirmControls.credixCode"
            [length]="6"
            class="w-50"
            errorMessage="Introduzca el codigo de confirmación">
          </credix-code-input>
        </form>
      </div>
      <mat-divider></mat-divider>
      <div class="marchamos__buttons" fxLayout="row" fxLayoutAlign="flex-end" fxLayoutGap="16px">
        <credix-button [stepper]="stepper" credixStepperPrevious text="Atras" type="secondary"></credix-button>
        <credix-button
          (buttonClick)="confirmModal()"
          [disabled]="!confirmControls.credixCode.value"
          text="Pagar"></credix-button>
      </div>
    </cdk-step>

  </credix-stepper>

  <div class="marchamos__footer" fxLayout="row" fxLayoutAlign="flex-end">
    <div fxLayoutGap="16px">
      <credix-button (buttonClick)="consult()" *ngIf="stepperIndex == 0" [disabled]="consultForm.invalid"
                     text="Consultar"
                     type="secondary"></credix-button>
      <credix-button (buttonClick)="back()" *ngIf="stepperIndex > 0" text="Atrás" type="secondary"></credix-button>
      <credix-button (buttonClick)="continue()" [disabled]="disableButton"
                     [text]="stepperIndex >= 2 ? 'Transferir' : 'Continuar'"></credix-button>
    </div>
  </div>
</mat-card>

<ng-template #resultTemplate>
  <result-pay-resume
    (responseResultPayChanged)="getAnotherPay($event)"
    [dataPay]="dataPay"
    [responseResultPay]="responseResultPay"
    [resultPay]="resultPay"></result-pay-resume>
</ng-template>
